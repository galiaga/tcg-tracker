{% extends "layout.html" %}

{% block title %}
    My Decks
{% endblock %}

{% block main %}
<div class="container max-w-4xl mx-auto px-4 py-6 space-y-6">

  <!-- 🔹 Sección de decks -->
  <div class="space-y-2">
    <h2 class="text-xl font-semibold text-gray-800">My Decks</h2>

    <div>
      <label for="sort_decks" class="block text-sm font-medium text-gray-700 mb-1">Sort by</label>
      <select id="sort_decks"
        class="w-full md:w-60 rounded-md border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
        <option value="last_match" selected>Last Match</option>
        <option value="matches">Matches</option>
        <option value="name">Deck name</option>
        <option value="winrate">Winrate</option>
      </select>
    </div>

    <!-- Botón para abrir modal -->
    <button id="newDeckModalButton" type="button"
      class="w-full md:w-auto bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg shadow-sm transition">
      New Deck
    </button>
  </div>

  <!-- Modal backdrop -->
  <div id="newDeckModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center px-4 hidden">
    <!-- Modal box -->
    <div class="bg-white rounded-xl shadow-xl w-full max-w-lg p-6 space-y-5 transform transition-all scale-95 opacity-0">

      <!-- Modal header -->
      <div class="flex items-center justify-between border-b pb-3">
        <h2 class="text-lg font-bold text-gray-800">New Deck</h2>
        <button id="newDeckModalCloseButton" type="button" aria-label="Close modal"
          class="text-gray-400 hover:text-gray-600 text-xl font-bold">
          &times;
        </button>
      </div>

      <!-- Modal body -->
      <form id="register-deck-form" class="space-y-4">

        <!-- Deck Type -->
        <div>
          <label for="deck_type" class="block text-sm font-medium text-gray-700 mb-1">Deck Type</label>
          <select id="deck_type" required
            class="w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
            <option value="" disabled selected>Loading deck types...</option>
          </select>
        </div>

        <!-- Conditional Fields (autocomplete inputs) -->
        {% for field in [
          ("commander", "Commander Name"),
          ("partner", "Who is the Partner?"),
          ("friendsForever", "Who is the BFF?"),
          ("doctorCompanion", "Who is the Doctor?"),
          ("timeLordDoctor", "Who is the Doctor's Companion?"),
          ("background", "Choose a commander"),
          ("chooseABackground", "Choose a background")
        ] %}
        <div id="{{ field[0] }}Field" class="hidden relative">
          <input autocomplete="off" id="{{ field[0] }}_name" placeholder="{{ field[1] }}" type="text"
            class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50" />
          <ul id="{{ field[0] }}-suggestions"
            class="absolute z-10 mt-1 w-full bg-white border border-gray-200 rounded-md shadow-lg"></ul>
        </div>
        {% endfor %}

        <!-- Deck Name -->
        <div>
          <label for="deck_name" class="block text-sm font-medium text-gray-700 mb-1">Deck Name</label>
          <input id="deck_name" type="text" autocomplete="off" placeholder="Enter a deck name"
            class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-800 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50" />
        </div>

        <!-- Register Button -->
        <button type="submit"
          class="w-full md:w-auto bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg shadow-sm transition">
          Register Deck
        </button>
      </form>
    </div>
  </div>

  <!-- 🗂️ Contenedor de decks -->
  <div id="decks-container" class="grid gap-4 md:grid-cols-2 xl:grid-cols-3"></div>
</div>
{% endblock %}

{% block scripts %}
    <script src="{{ url_for('static', filename='js/auth.js') }}"></script>
    <script src="/static/js/deck_types.js"></script>
    <script type="module" src="{{ url_for('static', filename='js/deckForm.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/api/user_decks.js') }}"></script>
    <script src="/static/js/registerDeck.js"></script>
    <script type="module" src="{{ url_for('static', filename='js/ui/decks/sort_decks.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ui/decks/new-deck-modal.js') }}"></script>
{% endblock %}
