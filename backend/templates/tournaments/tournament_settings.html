{% extends "layout.html" %}

{% block title %}
    Settings for {{ tournament.name | truncate(30) if tournament else "Tournament Settings" }}
{% endblock %}

{% block page_header %}
{# Consistent Page Header #}
<div class="flex justify-between items-center mb-4">
    <div class="flex items-center">
        <img src="{{ url_for('static', filename='img/logo.png') }}"
             alt="Logo TCG Tracker"
             class="h-10 w-10 mr-3">
        <h1 class="text-xl sm:text-2xl font-bold text-violet-900 dark:text-violet-200">
            Edit: <span class="text-violet-700 dark:text-violet-400">{{ tournament.name | truncate(35) }}</span>
        </h1>
    </div>
    {% if is_logged_in %}
    <a href="{{ url_for('frontend.profile_page') }}"
       aria-label="User Profile"
       class="md:hidden bg-violet-100 text-violet-700 dark:bg-violet-700 dark:text-violet-200 rounded-full p-2 shadow hover:bg-violet-200 dark:hover:bg-violet-600 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
          <path fill-rule="evenodd" d="M7.5 6a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM3.751 20.105a8.25 8.25 0 0 1 16.498 0 .75.75 0 0 1-.437.695A18.683 18.683 0 0 1 12 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 0 1-.437-.695Z" clip-rule="evenodd" />
        </svg>
    </a>
    {% endif %}
</div>
{% endblock %}

{% block main %}
<div class="space-y-4"> {# Consistent main content wrapper #}
    <form method="POST" action="{{ url_for('tournaments.tournament_settings', tournament_id=tournament.id) }}" novalidate 
          class="bg-white dark:bg-gray-800 shadow-xl rounded-xl border border-gray-200 dark:border-gray-700 
                 px-6 sm:px-8 pt-6 pb-8 space-y-5">
        {{ form.hidden_tag() }}

        <div>
            {{ form.name.label(class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1") }}
            {{ form.name(class="block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-violet-500 focus:border-violet-500 sm:text-sm text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500 " + ("border-red-500 dark:border-red-500" if form.name.errors else "")) }}
            {% if form.name.errors %}
                {% for error in form.name.errors %}
                    <p class="text-red-500 dark:text-red-400 text-xs italic mt-1">{{ error }}</p>
                {% endfor %}
            {% endif %}
        </div>

        <div>
            {{ form.description.label(class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1") }}
            {{ form.description(rows=4, class="block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-violet-500 focus:border-violet-500 sm:text-sm text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500 " + ("border-red-500 dark:border-red-500" if form.description.errors else "")) }}
            {% if form.description.errors %}
                {% for error in form.description.errors %}
                    <p class="text-red-500 dark:text-red-400 text-xs italic mt-1">{{ error }}</p>
                {% endfor %}
            {% endif %}
        </div>

        <div class="grid md:grid-cols-2 gap-x-6 gap-y-5">
            <div>
                {{ form.event_date.label(class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1") }}
                {{ form.event_date(class="block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-violet-500 focus:border-violet-500 sm:text-sm text-gray-900 dark:text-gray-100 " + ("border-red-500 dark:border-red-500" if form.event_date.errors else ""), type="datetime-local") }}
                {% if form.event_date.errors %}
                    {% for error in form.event_date.errors %}
                        <p class="text-red-500 dark:text-red-400 text-xs italic mt-1">{{ error }}</p>
                    {% endfor %}
                {% else %}
                     <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">{{ form.event_date.description }}</p>
                {% endif %}
            </div>
            <div>
                {{ form.format_.label(text="Game Format", class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1") }}
                {{ form.format_(class="block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-violet-500 focus:border-violet-500 sm:text-sm text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500 " + ("border-red-500 dark:border-red-500" if form.format_.errors else "")) }}
                {% if form.format_.errors %}
                    {% for error in form.format_.errors %}
                        <p class="text-red-500 dark:text-red-400 text-xs italic mt-1">{{ error }}</p>
                    {% endfor %}
                {% endif %}
            </div>
        </div>

        <div class="grid md:grid-cols-2 gap-x-6 gap-y-5">
            <div>
                {{ form.status.label(class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1") }}
                {{ form.status(class="block w-full pl-3 pr-10 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-violet-500 focus:border-violet-500 sm:text-sm text-gray-900 dark:text-gray-100 " + ("border-red-500 dark:border-red-500" if form.status.errors else "")) }}
                {% if form.status.errors %}
                    {% for error in form.status.errors %}
                        <p class="text-red-500 dark:text-red-400 text-xs italic mt-1">{{ error }}</p>
                    {% endfor %}
                {% endif %}
            </div>
            <div>
                {{ form.pairing_system.label(class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1") }}
                {{ form.pairing_system(class="block w-full pl-3 pr-10 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-violet-500 focus:border-violet-500 sm:text-sm text-gray-900 dark:text-gray-100 " + ("border-red-500 dark:border-red-500" if form.pairing_system.errors else "")) }}
                {% if form.pairing_system.errors %}
                    {% for error in form.pairing_system.errors %}
                        <p class="text-red-500 dark:text-red-400 text-xs italic mt-1">{{ error }}</p>
                    {% endfor %}
                {% endif %}
            </div>
        </div>

        <div>
            {{ form.max_players.label(class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1") }}
            {{ form.max_players(class="block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-violet-500 focus:border-violet-500 sm:text-sm text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500 " + ("border-red-500 dark:border-red-500" if form.max_players.errors else "")) }}
            {% if form.max_players.errors %}
                {% for error in form.max_players.errors %}
                    <p class="text-red-500 dark:text-red-400 text-xs italic mt-1">{{ error }}</p>
                {% endfor %}
            {% else %}
                 <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">{{ form.max_players.description }}</p>
            {% endif %}
        </div>

        <div class="pt-3 border-t border-gray-200 dark:border-gray-700 flex flex-col sm:flex-row items-center justify-between gap-4">
            {{ form.submit(class="w-full sm:w-auto bg-violet-700 hover:bg-violet-600 text-white font-semibold py-2.5 px-6 rounded-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2 dark:ring-offset-gray-800 transition duration-150 ease-in-out") }}
            <a href="{{ url_for('tournaments.view_tournament', tournament_id=tournament.id) }}"
               class="w-full sm:w-auto text-center text-sm font-medium text-violet-600 dark:text-violet-300 hover:text-violet-800 dark:hover:text-violet-100 hover:underline transition duration-150 ease-in-out px-6 py-2.5 rounded-lg border border-violet-300 dark:border-violet-600 hover:bg-violet-50 dark:hover:bg-violet-700">
                Cancel
            </a>
        </div>

        <div class="mt-2 pt-4 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400">
            <p>Created: {{ tournament.created_at.strftime('%Y-%m-%d %H:%M %Z') if tournament.created_at else 'N/A' }}</p>
            {% if tournament.updated_at and tournament.updated_at != tournament.created_at %}
                 <p>Last Updated: {{ tournament.updated_at.strftime('%Y-%m-%d %H:%M %Z') }}</p>
            {% endif %}
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script type="module" src="{{ url_for('static', filename='js/ui/tournaments/tournament_form.js') }}"></script>
{% endblock %}