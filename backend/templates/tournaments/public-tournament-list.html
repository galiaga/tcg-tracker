{% extends "layout.html" %}

{% block title %}
    Explore Tournaments
{% endblock %}

{% block page_header %} {# This header content will now be rendered by layout.html #}
<div class="flex justify-between items-center mb-4"> {# Consistent margin #}
    <div class="flex items-center">
        <img src="{{ url_for('static', filename='img/logo.png') }}"
             alt="Logo TCG Tracker"
             class="h-10 w-10 mr-3">
        <h1 class="text-2xl font-bold text-violet-900 dark:text-violet-200">Explore Tournaments</h1>
    </div>
    {% if is_logged_in %} {# Mobile profile icon - only shows if user happens to be logged in #}
    <a href="{{ url_for('frontend.profile_page') }}"
       aria-label="User Profile"
       class="md:hidden bg-violet-100 text-violet-700 dark:bg-violet-700 dark:text-violet-200 rounded-full p-2 shadow hover:bg-violet-200 dark:hover:bg-violet-600 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
          <path fill-rule="evenodd" d="M7.5 6a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM3.751 20.105a8.25 8.25 0 0 1 16.498 0 .75.75 0 0 1-.437.695A18.683 18.683 0 0 1 12 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 0 1-.437-.695Z" clip-rule="evenodd" />
        </svg>
    </a>
    {% endif %}
</div>
{% endblock %}

{% block main %}
{# This div ensures the content below the header takes up the available width
   and provides consistent spacing for the tournament list.
#}
<div class="w-full space-y-4">
    {% if tournaments %}
    <div id="public-tournaments-container" class="grid gap-4 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3">
        {% for tournament in tournaments %}
        <a href="{{ url_for('tournaments.view_tournament', tournament_id=tournament.id) }}"
           class="block bg-white dark:bg-gray-800 shadow-lg hover:shadow-xl transition-shadow duration-200 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden group">
            <div class="p-5">
                <div class="flex justify-between items-start mb-2">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 group-hover:text-violet-700 dark:group-hover:text-violet-400 transition-colors">
                        {{ tournament.name | truncate(40) }}
                    </h3>
                    <span class="px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full
                        {% if tournament.status == 'Planned' %} bg-blue-100 text-blue-800 dark:bg-blue-700 dark:text-blue-100
                        {% elif tournament.status == 'Active' %} bg-green-100 text-green-800 dark:bg-green-700 dark:text-green-100
                        {% elif tournament.status == 'Completed' %} bg-gray-200 text-gray-700 dark:bg-gray-600 dark:text-gray-100
                        {% elif tournament.status == 'Cancelled' %} bg-red-100 text-red-800 dark:bg-red-700 dark:text-red-100
                        {% else %} bg-yellow-100 text-yellow-800 dark:bg-yellow-700 dark:text-yellow-100
                        {% endif %}">
                        {{ tournament.status }}
                    </span>
                </div>

                <div class="space-y-1 text-sm text-gray-600 dark:text-gray-300">
                    <p>
                        <span class="font-medium text-gray-700 dark:text-gray-200">Date:</span>
                        {{ tournament.event_date.strftime('%b %d, %Y %I:%M %p %Z') if tournament.event_date else 'Not set' }}
                    </p>
                    {% if tournament.format %}
                    <p>
                        <span class="font-medium text-gray-700 dark:text-gray-200">Format:</span>
                        {{ tournament.format }}
                    </p>
                    {% endif %}
                    <p>
                        <span class="font-medium text-gray-700 dark:text-gray-200">Players:</span>
                        {{ tournament.participants.count() }}{% if tournament.max_players %}<span class="text-gray-500 dark:text-gray-400"> / {{ tournament.max_players }}</span>{% else %}<span class="text-gray-400"> / ∞</span>{% endif %}
                    </p>
                </div>
            </div>
             <div class="bg-gray-50 dark:bg-gray-750 px-5 py-3 border-t border-gray-100 dark:border-gray-650">
                <p class="text-xs text-violet-600 dark:text-violet-400 font-medium text-right">View Details →</p>
            </div>
        </a>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-12 bg-white dark:bg-gray-800 shadow-lg rounded-xl border border-gray-200 dark:border-gray-700 mt-6">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="mx-auto h-12 w-12 text-gray-400 dark:text-gray-500">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
        </svg>
        <h3 class="mt-2 text-sm font-semibold text-gray-900 dark:text-gray-100">No Public Tournaments Found</h3>
        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Check back later for upcoming tournaments, or create your own if you're an organizer.</p>
        {% if is_logged_in %}
        <div class="mt-6">
            <a href="{{ url_for('tournaments.create_tournament') }}"
               class="inline-flex items-center bg-violet-600 hover:bg-violet-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2 transition duration-150 ease-in-out">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 mr-2 -ml-1">
                    <path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
                </svg>
                Create New Tournament
            </a>
        </div>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
    {{ super() }}
{% endblock %}