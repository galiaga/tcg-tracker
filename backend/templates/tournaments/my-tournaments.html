{% extends "layout.html" %}

{% block title %}
    My Tournaments
{% endblock %}

{% block page_header %}
<div class="flex flex-wrap justify-between items-center mb-6 md:mb-8">
    <div class="flex items-center">
        <img src="{{ url_for('static', filename='img/logo.png') }}"
             alt="Logo TCG Tracker"
             class="h-10 w-10 mr-3">
        <h1 class="text-2xl sm:text-3xl font-bold text-violet-900">My Tournaments</h1>
    </div>
    {% if is_logged_in %}
    <a href="{{ url_for('frontend.profile_page') }}"
       aria-label="User Profile"
       class="md:hidden bg-violet-100 text-violet-700 rounded-full p-2 shadow hover:bg-violet-200 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
          <path fill-rule="evenodd" d="M7.5 6a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM3.751 20.105a8.25 8.25 0 0 1 16.498 0 .75.75 0 0 1-.437.695A18.683 18.683 0 0 1 12 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 0 1-.437-.695Z" clip-rule="evenodd" />
        </svg>
    </a>
    {% endif %}
</div>
{% endblock %}

{% block main %}
<div class="container mx-auto px-4 py-2">

    <section aria-labelledby="tournament-main-action-heading" class="mb-6">
        <h2 id="tournament-main-action-heading" class="sr-only">Main Tournament Actions</h2>
        <div class="flex-grow">
            <a href="{{ url_for('tournaments.create_tournament') }}"
              role="button"
              class="block w-full text-center bg-violet-700 hover:bg-violet-600 text-white text-base sm:text-lg font-semibold py-3 px-4 rounded-xl shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2 transition duration-150 ease-in-out border border-transparent">
              Create New Tournament
            </a>
        </div>
    </section>

    {# Sort/Filter Controls - Placeholder, you'd implement JS for this like in My Decks #}
    {# This section would be similar to your my-decks.html filter controls #}
    <div id="tournament-filter-controls" class="md:grid md:grid-cols-2 lg:grid-cols-3 gap-4 bg-white shadow-md rounded-xl border border-gray-200 p-4 mb-6">
        <div>
            <label for="sort_tournaments" class="block text-sm font-medium text-gray-700 mb-1">Sort by</label>
            <select id="sort_tournaments" name="sort_by"
              class="w-full rounded-md border-gray-300 shadow-sm focus:border-violet-500 focus:ring focus:ring-violet-500 focus:ring-opacity-50 text-sm">
              <option value="event_date_desc" {% if current_sort_by == 'event_date' and current_sort_order == 'desc' %}selected{% endif %}>Event Date (Newest)</option>
              <option value="event_date_asc" {% if current_sort_by == 'event_date' and current_sort_order == 'asc' %}selected{% endif %}>Event Date (Oldest)</option>
              <option value="name_asc" {% if current_sort_by == 'name' and current_sort_order == 'asc' %}selected{% endif %}>Name (A-Z)</option>
              <option value="name_desc" {% if current_sort_by == 'name' and current_sort_order == 'desc' %}selected{% endif %}>Name (Z-A)</option>
              <option value="created_at_desc" {% if current_sort_by == 'created_at' and current_sort_order == 'desc' %}selected{% endif %}>Date Added (Newest)</option>
              {# Add other sort options as needed, e.g., status #}
            </select>
        </div>
        <div>
            <label for="filter_status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
            <select id="filter_status" name="status"
              class="w-full rounded-md border-gray-300 shadow-sm focus:border-violet-500 focus:ring focus:ring-violet-500 focus:ring-opacity-50 text-sm">
              <option value="">All Statuses</option>
              <option value="Planned">Planned</option>
              <option value="Active">Active</option>
              <option value="Completed">Completed</option>
              <option value="Cancelled">Cancelled</option>
            </select>
        </div>
        {# Add more filters like Format if needed #}
    </div>


    {% if organized_tournaments %}
    <div id="tournaments-container" class="grid gap-4 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3">
        {% for tournament in organized_tournaments %}
        <a href="{{ url_for('tournaments.view_tournament', tournament_id=tournament.id) }}"
           class="block bg-white shadow-lg hover:shadow-xl transition-shadow duration-200 rounded-xl border border-gray-200 overflow-hidden group">
            <div class="p-5">
                <div class="flex justify-between items-start mb-2">
                    <h3 class="text-lg font-semibold text-gray-800 group-hover:text-violet-700 transition-colors">
                        {{ tournament.name | truncate(40) }}
                    </h3>
                    <span class="px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full 
                        {% if tournament.status == 'Planned' %} bg-blue-100 text-blue-800
                        {% elif tournament.status == 'Active' %} bg-green-100 text-green-800
                        {% elif tournament.status == 'Completed' %} bg-gray-200 text-gray-700
                        {% elif tournament.status == 'Cancelled' %} bg-red-100 text-red-800
                        {% else %} bg-yellow-100 text-yellow-800
                        {% endif %}">
                        {{ tournament.status }}
                    </span>
                </div>

                <div class="space-y-1 text-sm text-gray-600">
                    <p>
                        <span class="font-medium text-gray-700">Date:</span>
                        {{ tournament.event_date.strftime('%b %d, %Y %I:%M %p') if tournament.event_date else 'Not set' }}
                    </p>
                    {% if tournament.format %}
                    <p>
                        <span class="font-medium text-gray-700">Format:</span>
                        {{ tournament.format }}
                    </p>
                    {% endif %}
                    <p>
                        <span class="font-medium text-gray-700">Players:</span>
                        {{ tournament.participants.count() }}{% if tournament.max_players %}<span class="text-gray-500"> / {{ tournament.max_players }}</span>{% else %}<span class="text-gray-400"> / ∞</span>{% endif %}
                    </p>
                </div>
            </div>
            {# Optional: Add a subtle footer to the card if needed, e.g., for a "View Details" prompt if the whole card isn't obviously clickable #}
            {# <div class="bg-gray-50 px-5 py-3 border-t border-gray-100">
                <p class="text-xs text-violet-600 font-medium text-right">View Details →</p>
            </div> #}
        </a>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-12 bg-white shadow-lg rounded-xl border border-gray-200 mt-6">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="mx-auto h-12 w-12 text-gray-400">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
        </svg>
        <h3 class="mt-2 text-sm font-semibold text-gray-900">No tournaments organized yet</h3>
        <p class="mt-1 text-sm text-gray-500">Get started by creating a new tournament.</p>
        <div class="mt-6">
            <a href="{{ url_for('tournaments.create_tournament') }}"
               class="inline-flex items-center bg-violet-600 hover:bg-violet-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2 transition duration-150 ease-in-out">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 mr-2 -ml-1">
                    <path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
                </svg>
                Create New Tournament
            </a>
        </div>
    </div>
    {% endif %}

</div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script>
        // Basic JS for sort/filter controls to reload the page with query parameters
        document.addEventListener('DOMContentLoaded', function () {
            const sortSelect = document.getElementById('sort_tournaments');
            const statusFilterSelect = document.getElementById('filter_status');

            function updateQueryAndReload() {
                const params = new URLSearchParams(window.location.search);
                
                if (sortSelect && sortSelect.value) {
                    const [sortBy, sortOrder] = sortSelect.value.split('_');
                    params.set('sort_by', sortBy);
                    params.set('sort_order', sortOrder);
                } else {
                    params.delete('sort_by');
                    params.delete('sort_order');
                }

                if (statusFilterSelect && statusFilterSelect.value) {
                    params.set('status_filter', statusFilterSelect.value);
                } else {
                    params.delete('status_filter');
                }
                
                window.location.search = params.toString();
            }

            if (sortSelect) {
                sortSelect.addEventListener('change', updateQueryAndReload);
            }
            if (statusFilterSelect) {
                statusFilterSelect.addEventListener('change', updateQueryAndReload);
            }

            // Set initial values for selects based on URL params (if any)
            const urlParams = new URLSearchParams(window.location.search);
            const currentSortBy = urlParams.get('sort_by');
            const currentSortOrder = urlParams.get('sort_order');
            const currentStatusFilter = urlParams.get('status_filter');

            if (sortSelect && currentSortBy && currentSortOrder) {
                sortSelect.value = `${currentSortBy}_${currentSortOrder}`;
            }
            if (statusFilterSelect && currentStatusFilter) {
                statusFilterSelect.value = currentStatusFilter;
            }
        });
    </script>
{% endblock %}